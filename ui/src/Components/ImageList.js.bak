import React, { useEffect, useState } from "react";
import Button from "@mui/material/Button";
import { createDockerDesktopClient } from '@docker/extension-api-client';

const client = createDockerDesktopClient();

function useDockerDesktopClient() {
    return client;
}

function invalidTags(image) {
  if(!image.RepoTags) return false;
  else if(!image.RepoTags[0]) return false;
  else if(image.RepoTags[0].match(/(<none>)/)) return false;
  return true;
}

function ImageList(props) {
  const [images,setImages] = useState([]);
  const ddClient = useDockerDesktopClient();

  useEffect(() => {
    async function getImages() {
      const images = await ddClient.docker.listImages();
      setImages(images.filter(invalidTags));
    }
    getImages()
  })

  function scan(tag) {
    if(props.onScan) props.onScan(tag);
  }

  return (
    <table className="image_list">
      <tr><th>image</th><td>actions</td></tr>
      {images.map(image => (
        <tr><td>{image?.RepoTags[0]}</td><td><Button variant="contained" onClick={()=>scan(image.RepoTags[0])}>Scan Image</Button></td></tr>
      ))}
    </table>
  );
}

export default ImageList;